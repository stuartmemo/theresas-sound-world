/* Theresa's Sound World 0.0.1 (c) 2013 Stuart Memo */
window.tsw=function(e,t){"use strict";var n=function(e,t){for(var n in t)e[n]=t[n];return e},r=function(e,t){for(var n in t)e[n].value=t[n]},a=function(e){return Array.isArray(e)},o=function(e){var t=!1;return Object(e)&&"node"in e&&(t=!0),t},i=function(e){return e.hasOwnProperty("context")},c=function(e){return e.hasOwnProperty("input")||e.hasOwnProperty("output")},u={},s=[];u.version="0.0.1",u.processors=[],u.isBrowserCompatible=!1;var f=function(){u.noise_buffer=u.createBuffer();for(var e=0;u.noise_buffer.length>e;e++)u.noise_buffer.getChannelData(0)[e]=2*Math.random()-1},p=function(e,n){if("undefined"==typeof webkitAudioContext&&"undefined"==typeof AudioContext)if(webkitAudioContext.prototype.createGainNode===t)n("Sorry, your browser doesn't support a recent enough version of the Web Audio API.");else{var r=webkitAudioContext.prototype;r.createGain=r.createGainNode,r.createDelay=r.createDelayNode,r.createScriptProcessor=r.createJavaScriptNode}else u.context="function"==typeof AudioContext?new AudioContext:new webkitAudioContext;u.isBrowserCompatible=!0,e()},l=function(){u.speakers=u.context.destination};u.now=function(){return this.context.currentTime},u.createChannelMerger=function(e){return u.context.createChannelMerger(e)},u.connect=function(){for(var e=function(){arguments[0].connect(arguments[1])},t=function(){arguments[0].connect(arguments[1].input)},n=function(){for(var e=0;arguments[1].length>e;e++)u.connect(arguments[0],arguments[1][e])},r=function(){for(var e=0;arguments[0].length>e;e++)u.connect(arguments[0][e],arguments[1])},s=function(){arguments[0].output.connect(arguments[1])},f=function(){for(var e=0;arguments[0].length>e;e++)this.connect(arguments[0][e],arguments[1])},p=function(){for(var e=0;arguments[0].length>e;e++)this.connect(arguments[0][e],arguments[1])},l=function(){arguments[0].node.connect(arguments[1].node,arguments[0].channel,arguments[1].channel)},h=0;arguments.length-1>h;h++){var v=arguments[h],m=arguments[h+1];i(v)&&c(m)?t(v,m):c(v)&&i(m)?s(v,m):i(v)&&a(m)?n(v,m):a(v)&&i(m)?r(v,m):i(v)&&i(m)?e(v,m):c(v)&&c(m)?connectTswNode(v,m):c(v)&&a(m)?connectTswNodeToArray(v,m):a(v)&&c(m)?f(v,m):a(v)&&a(m)?p(v,m):o(v)&&a(m)?connectObjectWithNodeToArray(v,m):a(v)&&o(m)?connectArrayToObjectWithNode(v,m):o(v)&&o(m)&&l(v,m)}},u.disconnect=function(){for(var e=arguments.length,t=0;e>t;t++)arguments[t].disconnect()},u.disconnectAfterTime=function(e,t){s.push({node:e,time:t})},u.load=function(e,t,n){var r={},e=e||"",a=0,o=0,i=this,c=function(t,n,r,c){var u=new XMLHttpRequest;u.open("GET",e+n,!0),u.responseType="arraybuffer",u.onload=function(){a++,i.context.decodeAudioData(u.response,function(e){r[t]=i.context.createBufferSource(),r[t].buffer=e,r[t].play=function(){i.play(this)},r[t].stop=function(){i.stop(this)},r[t].isPlaying=function(){return this.playbackState},a===o&&c(r)})},u.send()};if("object"==typeof t)for(var u in t)o++,c(u,t[u],r,n);else{if("string"!=typeof t)throw Error("Files must be an array or a valid string.");o=1,c(u,t[u],r,n)}},u.createDelay=function(e){var t=this.context.createDelay();return t.delayTime.value=e||0,t},u.createMonoMaker=function(){var e={};return e.input=u.createGain(),e.output=u.createGain(),u.connect(e.input,e.output),e},u.createPanner=function(e){var t={},n=u.createGain(1),r=u.createGain(0),a=u.createChannelMerger(2);return t.input=u.createGain(),t.output=u.createGain(),t.value=e,t.value>1?t.value=1:-1>t.value&&(t.value=-1),n.gain.value=1-100*.01*((1+t.value)/2),r.gain.value=1-n.gain.value,u.connect(t.input,[n,r]),u.connect({node:n,channel:0},{node:a,channel:0}),u.connect({node:r,channel:0},{node:a,channel:1}),u.connect(a,t.output),t},u.play=function(e,t){t=t||0,e.start(t)},u.stop=function(e,t){t=t||0,e.stop(t)},u.reverse=function(e){for(var t=0;e.buffer.numberOfChannels>t;t++)Array.prototype.reverse.call(e.buffer.getChannelData(t));return e},u.createOscillator=function(e,n){var r=this.context.createOscillator();return r.start===t&&(r.start=r.noteOn,r.stop=r.noteOff),e=e||"SINE",e=e.toUpperCase(),r.type=r[e],r.safariType=e.toLowerCase(),r.frequency.value=n||440,r},u.createGain=function(e){var t;return t="function"==typeof this.context.createGain?this.context.createGain():this.context.createGainNode(),t.gain.value=e||1,t},u.createBuffer=function(e,t,n){return e=e||1,t=t||65536,n=n||44100,this.context.createBuffer(e,t,n)},u.createBufferSource=function(e){var n=this.context.createBufferSource();return n.buffer=e,n.start===t&&(n.start=n.noteOn,n.stop=n.noteOff),n},u.createFilter=function(e,t,n){var r=e||"lowpass",a=this.context.createBiquadFilter();return a.type=r,a.frequency.value=t||0,a.Q.value=n||0,a},u.createAnalyser=function(){return this.context.createAnalyser()},u.createCompressor=function(e){var t=this.context.createDynamicsCompressor(),a={threshold:-24,knee:30,ratio:12,attack:.003,release:.25};return e=n(a,e),r(t,e),t},u.createProcessor=function(e,t){var n=e||1024,r=u.context.createScriptProcessor(n,1,1);return"function"==typeof t&&(r.onaudioprocess=function(e){t(e)}),r},u.createWaveShaper=function(){for(var e=new Float32Array(65536),t=0;32768>t;t++)e[t]=3e4>t?.1:-1;var n=this.context.createWaveShaper();return n.curve=e,n},u.createEnvelope=function(e){var n={};return e=e||{},n.startLevel=e.startLevel||0,n.maxLevel=e.maxLevel||1,n.minLevel=e.minLevel||0,n.attackTime=e.attackTime||0,n.decayTime=e.decayTime||0,n.sustainLevel=e.sustainLevel||0,n.releaseTime=e.releaseTime||0,n.param=e.param||{},n.param.value=n.startLevel,n.autoStop=e.autoStop===t?!0:e.autoStop,n.start=function(e){this.maxLevel=this.startLevel+this.maxLevel,this.sustainLevel=this.startLevel+this.sustainLevel;var t=e||u.now(),n=t+this.attackTime,r=n+this.decayTime,a=r+this.releaseTime;this.param.cancelScheduledValues(t),this.param.setValueAtTime(this.startLevel,t),this.param.linearRampToValueAtTime(this.maxLevel,n),this.param.linearRampToValueAtTime(this.startLevel+this.sustainLevel,r),this.autoStop&&(this.param.linearRampToValueAtTime(this.minLevel,a),this.stop(a))},n.stop=function(e){e=e||u.now(),e+=this.releaseTime,this.autoStop||this.param.linearRampToValueAtTime(this.minLevel,this.releaseTime)},n},u.createNoise=function(){var e=this.createBufferSource(u.noise_buffer);return e.loop=!0,e},u.createLFO=function(e){var t=u.createOscillator(),r=this.createGain(),a={frequency:0,waveType:"triangle",depth:1,target:null,autoStart:!1};return e=n(a,e),t.type=t[e.waveType]||t.TRIANGLE,r.gain.value=e.depth,t.frequency.value=e.frequency,e.autoStart&&t.start(u.now()),t.modulate=function(e){this.connect(r),r.connect(e)},t.setWaveType=function(e){t.type=t[e.toUpperCase()]},t.setFrequency=function(e){t.frequency.value=e},t.setDepth=function(e){r.gain.value=e},t.modulate(e.target),t},u.getUserAudio=function(e){var t=function(t){var n=u.context.createMediaStreamSource(t);e(n)};navigator.webkitGetUserMedia({audio:!0},t)};var h=function(){(function e(){s.forEach(function(e){e.time<u.now()&&u.disconnect(e.node)}),setTimeout(e,500)})()};return function(){p(function(){l(),f(),h()},function(e){console.log(e)})}(),u}(window),function(){"use strict";var e=e||{};e.createDelay=function(t){var n={},r=e.context.createDelay(),a=e.context.createGain(),o=e.context.createGain(),i=e.createGain();return n.input=e.createGain(),n.output=e.createGain(),n.settings={delayTime:.5,feedback:.5,effectLevel:.5},t=t||{},r.delayTime.value=t.delayTime||n.settings.delayTime,a.gain.value=t.feedback||n.settings.feedback,o.gain.value=t.effectLevel||n.settings.effectLevel,e.connect(n.input,i,r,a,r,o,n.output),e.connect(i,r),n},e.createDistortion=function(t){var n={},r=e.context.createWaveShaper(),a=e.context.createBiquadFilter(),o=e.context.createBiquadFilter();return n.settings={distortionLevel:.5},t=t||{},n.input=e.createGain(),n.output=e.createGain(),e.connect(n.input,r,[a,o],n.output),n},e.createFlanger=function(){var e={};return e},e.createPhaser=function(t){var n={},r=[],a=e.createGain(),o={rate:8,depth:.5,feedback:.8};t=t||{},a.gain.value=t.gain||o.gain;for(var i=0;config.rate>i;i++)r[i]=e.context.createBiquadFilter(),r[i].type=7,r[i].frequency.value=100*i;n.input=e.createGain(),n.output=e.createGain();for(var i=0;r.length-1>i;i++)e.connect(r[i],r[i+1]);return e.connect(n.input,r[0],r[r.length-1],a,r[0]),e.connect(r[r.length-1],n.output),n.setCutoff=function(){for(var e=0;r.length>e;e++);},n},e.createReverb=function(t){var n=e.context.createConvolver(),r=e.createGain(),a={},o={effectLevel:.5,reverbTime:.5,reverbType:"spring",reverbPath:""};return t=t||{},r.gain.value=t.effectLevel||o.effectLevel,e.load({hall:"/effects/reverb/responses/bright-hall.wav",room:"/effects/reverb/responses/medium-room.wav",spring:"/effects/reverb/responses/feedback-spring.wav"},function(t){o.reverbPath=t[o.reverbType],n.buffer=o.reverbPath,a.input=e.createGain(),a.output=e.createGain(),e.connect(a.input,[a.output,n]),e.connect(n,r),e.connect(r,a.output)}),a},e.createTremolo=function(t){var n={},r=(e.createGain(),this.createLFO()),a=this;return t=t||{},n.input=e.createGain(),n.connect=function(e){n.input.connect(e),r.modulate(n.input.gain),r.start(a.now())},n.setRate=function(e){r.setFrequency(e)},n.setDepth=function(e){r.setDepth(e)},n}}(window),function(){"use strict";var e=e||{},t=["A","A#","B","C","C#","D","D#","E","F","F#","G","G#"];t.push.apply(t,t);var n=["unison","flat 2nd","2nd","minor 3rd","major 3rd","perfect 4th","flat 5th","perfect 5th","minor 6th","major 6th","minor 7th","major 7th","octave","flat 9th","9th","sharp 9th","major 10th","11th","augmented 11th","perfect 12th","flat 13th","13th"],r=function(e){for(var n,r=t.length,a=0;r>a;a++)if(e.toUpperCase()===t[a])return n=a,a;return null},a=function(e){var n=[],a=r(e);return n.push(t[a]),n.push(t[a+2]),n.push(t[a+4]),n.push(t[a+5]),n.push(t[a+7]),n.push(t[a+9]),n.push(t[a+11]),n.push(t[a+12]),n},o=function(e){var n=[],a=r(e);return n.push(t[a]),n.push(t[a+2]),n.push(t[a+3]),n.push(t[a+5]),n.push(t[a+7]),n.push(t[a+8]),n.push(t[a+10]),n.push(t[a+12]),n};e.parseChord=function(n){var a={},o=[],i=0;return Array.isArray(n)?!1:(n=n.toLowerCase(),a.rootNote=n[0].toUpperCase(),a.isMajor=n.indexOf("maj")>-1,a.isMinor=!a.isMajor&&n.indexOf("m")>-1,a.is7th=n.indexOf("7")>-1,a.notes=[],a.is7th||(a.octave=n.match(/\d/g)),a.isMajor||a.isMinor?(i=r(a.rootNote),o.push(i),n.isMinor?o.push(i+e.getSemitoneDifference("minor 3rd")):o.push(i+e.getSemitoneDifference("major 3rd")),o.push(i+e.getSemitoneDifference("perfect 5th")),o.push(i+e.getSemitoneDifference("octave")),o.forEach(function(e){a.notes.push(t[e])}),a.notes):!1)},e.getScale=function(e,t){return"minor"===t?o(e):a(e)},e.getSemitoneDifference=function(e){for(var t=n.length,r=0;t>r;r++)if(e===n[r])return r},e.isChord=function(e){return this.parseChord(e)},e.chordToNotes=function(e){return e=this.parseChord(e),e.notes},e.noteToFrequency=function(e){var n,r;return n=3===e.length?e.charAt(2):e.charAt(1),r=t.indexOf(e.slice(0,-1)),r=3>r?r+12+12*(n-1)+1:r+12*(n-1)+1,Math.round(440*Math.pow(2,(r-49)/12))}}(window),function(e){"use strict";var t=function(){var e=function(e){this.context=e};return e.prototype.getUserMIDI=function(e,t){navigator.requestMIDIAccess().then(e,t)},e.prototype.MIDINumberToNote=function(e){var t=e%12,n=Math.floor(e/12),r=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];return r[t]+n},e}();e.tsw.midi=new t}(window);